<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Othello Game</title>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 20px; }
        canvas { border: 2px solid black; margin-top: 10px; }
        select, button { margin: 5px; }
        #description { margin: 20px auto; max-width: 600px; text-align: left; }
            #win-bar-container {
            width: 400px;
            height: 30px;
            background-color: white;
            border: 2px solid #333;
            margin: 15px auto;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            display: flex;
        }
        #black-bar {
            height: 100%;
            background-color: #000;
            width: 50%;
            transition: width 0.5s ease-in-out;
        }
        #white-bar {
            height: 100%;
            background-color: #eee;
            flex-grow: 1;
        }
        #win-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            color: #ff5722;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
            pointer-events: none;
        }
    </style>
</head>
<body>
<h1>Othello</h1>

<div id="description">
    <h3>About this Othello AI</h3>
    <p>This Othello game supports multiple AI and human players. You can play against:</p>
    <ul>
        <li><strong>Random:</strong> picks any legal move randomly</li>
        <li><strong>Computer:</strong> heuristic-based algorithm (corners, edges, mobility)</li>
        <li><strong>AI Model:</strong> trained using reinforcement learning (PPO)</li>
        <li><strong>Prediction Value: </strong> the bar below the board shows the win chance for <strong>Black</strong> based on simulations. It is saved with every move, so you can see how the advantage shifted as you navigate through the game history.</li>
</div>
    </ul>
</div>

<div>
    Black: 
    <select id="blackPlayer">
        <option value="human">Human</option>
        <option value="random">Random</option>
        <option value="computer">Computer</option>
        <option value="ai">AI Model</option>
    </select>
    White: 
    <select id="whitePlayer">
        <option value="human">Human</option>
        <option value="random">Random</option>
        <option value="computer">Computer</option>
        <option value="ai">AI Model</option>
    </select>
</div>

<div>
    <button id="startBtn">Start Game</button>
    <button id="resetBtn">Reset Game</button>
    <button id="backBtn">⏮️ Previous Move</button>
    <button id="forwardBtn">⏭️ Next Move</button>
</div>

<canvas id="board" width="400" height="400"></canvas>

<!-- Win Chance Bar -->
<div id="win-bar-container">
    <div id="black-bar"></div>
    <div id="white-bar"></div>
    <div id="win-text">Black Win Chance: 50%</div>
</div>

<div id="status">Current Turn: Black</div>

<script>
const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");
const SIZE = 8;
const CELL = canvas.width / SIZE;

function updateUI(data) {
    drawBoard(data.board);
    updateWinBar(data.win_pct);
    document.getElementById("status").innerText = "Current Turn: " + (data.turn || "Unknown");
}

function updateWinBar(percent) {
    const p = parseFloat(percent).toFixed(1);
    document.getElementById("black-bar").style.width = p + "%";
    document.getElementById("win-text").innerText = `Black Win Chance: ${p}%`;
}

function drawGrid(){
    ctx.strokeStyle = "rgba(0,0,0,0.3)";
    for(let i=0;i<=SIZE;i++){
        ctx.beginPath(); ctx.moveTo(i*CELL,0); ctx.lineTo(i*CELL,canvas.height); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,i*CELL); ctx.lineTo(canvas.width,i*CELL); ctx.stroke();
    }
}

function drawBoard(b){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawGrid();
    for(const key in b){
        const [r,c] = key.split(",").map(Number);
        const color = b[key];
        const x = c*CELL+CELL/2;
        const y = r*CELL+CELL/2;
        const radius = CELL/2-6;
        
        ctx.beginPath();
        ctx.arc(x,y,radius,0,Math.PI*2);
        ctx.fillStyle = color === "black" ? "#000" : "#fff";
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#333";
        ctx.stroke();
    }
}

document.getElementById("startBtn").onclick = () => {
    const black = document.getElementById("blackPlayer").value;
    const white = document.getElementById("whitePlayer").value;
    fetch("/start_game", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ blackPlayer: black, whitePlayer: white })
    })
    .then(r => r.json())
    .then(data => {
        updateUI(data);
        if (data.nextPlayerType !== "human") setTimeout(autoPlay, 10);
    });
};

document.getElementById("resetBtn").onclick = () => {
    fetch("/start_game", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ 
            blackPlayer: document.getElementById("blackPlayer").value, 
            whitePlayer: document.getElementById("whitePlayer").value 
        })
    }).then(r=>r.json()).then(updateUI);
};

document.getElementById("backBtn").onclick = () => {
    fetch("/navigate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({direction:"back"})})
    .then(r=>r.json()).then(updateUI);
};

document.getElementById("forwardBtn").onclick = () => {
    fetch("/navigate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({direction:"forward"})})
    .then(r=>r.json()).then(updateUI);
};

canvas.addEventListener("click", e => {
    const rect = canvas.getBoundingClientRect();
    const col = Math.floor((e.clientX - rect.left) / CELL);
    const row = Math.floor((e.clientY - rect.top) / CELL);
    fetch("/human_move", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ row, col })
    })
    .then(r => r.json())
    .then(data => {
        updateUI(data);
        if (!data.end && data.nextPlayerType !== "human") setTimeout(autoPlay, 1000);
    });
});

function autoPlay() {
    fetch("/step", { method: "POST" })
        .then(r => r.json())
        .then(data => {
            updateUI(data);
            if (!data.end && data.nextPlayerType !== "human") setTimeout(autoPlay, 1000);
        });
}

// Initial
document.getElementById("startBtn").click();
</script>
</body>
</html>